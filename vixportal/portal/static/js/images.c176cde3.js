(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["images"],{"0c6d":function(e,t,a){"use strict";a.d(t,"c",(function(){return r})),a.d(t,"a",(function(){return n})),a.d(t,"b",(function(){return o}));var i=a("bc3a"),s=a.n(i);function r(e){var t=s.a.create({baseURL:window.url.ssourl,timeout:5e3});return t(e)}function n(e){var t=s.a.create({baseURL:window.url.coreurl,timeout:5e3});return t(e)}function o(e){var t=s.a.create({baseURL:window.url.vneturl,timeout:5e3});return t(e)}},"16c7":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"container"},[a("div",{staticStyle:{"margin-bottom":"10px"}},[a("el-button",{attrs:{type:"primary",icon:"el-icon-upload"},on:{click:function(t){e.AddImageForm=!0}}},[e._v("上传镜像")]),a("el-dialog",{attrs:{title:"创建系统镜像",visible:e.AddImageForm,width:"30%",center:"","close-on-click-modal":!1},on:{close:e.AddImageDialogClose,"update:visible":function(t){e.AddImageForm=t}}},[a("el-form",{ref:"AddImageRef",attrs:{model:e.add_image,rules:e.AddImageRules,"label-width":"120px","label-position":"left"}},[a("el-form-item",{attrs:{label:"磁盘镜像名称",prop:"image"}},[a("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"磁盘镜像名称","auto-complete":"off"},model:{value:e.add_image.image,callback:function(t){e.$set(e.add_image,"image",t)},expression:"add_image.image"}})],1),a("el-form-item",{attrs:{label:"磁盘镜像描述",prop:"desc"}},[a("el-select",{staticStyle:{width:"200px"},attrs:{placeholder:"磁盘镜像描述"},model:{value:e.add_image.desc,callback:function(t){e.$set(e.add_image,"desc",t)},expression:"add_image.desc"}},[a("el-option",{key:"linux",attrs:{label:"Linux",value:"linux"}}),a("el-option",{key:"win",attrs:{label:"Windows",value:"win"}})],1)],1),a("el-form-item",{attrs:{label:"上传镜像文件",prop:"file"}},[a("el-upload",{ref:"upload",staticClass:"avatar-uploader",attrs:{"show-file-list":!0,action:"",multiple:!1,"before-upload":e.UploadForm,"auto-upload":!1,"file-list":e.fileList,limit:1}},[a("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:e.CreateImage}},[e._v("确 定")]),a("el-button",{on:{click:function(t){e.AddImageForm=!1}}},[e._v("取 消")])],1)],1),a("el-dialog",{attrs:{title:"修改镜像用户",visible:e.EditImageForm,width:"30%",center:""},on:{close:e.EditImageDialogClose,"update:visible":function(t){e.EditImageForm=t}}},[a("el-form",{ref:"EditImageRef",attrs:{model:e.EditImage,rules:e.EditImageRules,"label-width":"120px","label-position":"left"}},[a("el-form-item",{attrs:{label:"设置镜像用户",prop:"user"}},[a("el-select",{staticStyle:{width:"200px"},attrs:{filterable:"",placeholder:"磁盘镜像用户"},model:{value:e.EditImage.user,callback:function(t){e.$set(e.EditImage,"user",t)},expression:"EditImage.user"}},e._l(e.UserList,(function(e){return a("el-option",{key:e.id,attrs:{label:e.username,value:e.username}})})),1)],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:e.ImageEditForm}},[e._v("确 定")]),a("el-button",{on:{click:function(t){e.EditImageForm=!1}}},[e._v("取 消")])],1)],1),a("el-dialog",{attrs:{title:"系统镜像详细资料",visible:e.DetailImageForm,width:"50%",center:"","close-on-click-modal":!1},on:{"update:visible":function(t){e.DetailImageForm=t}}},[a("div",{attrs:{"text-align:center":""}},[a("b-table-simple",{attrs:{hover:"",small:"","caption-top":"",responsive:""}},[a("b-tbody",[a("b-tr",[a("b-td",{attrs:{colspan:"2"}},[e._v("系统镜像名称")]),a("b-td",{attrs:{colspan:"1"}},[e._v(e._s(e.ImageData.image))])],1),a("b-tr",[a("b-td",{attrs:{colspan:"2"}},[e._v("系统镜像用户")]),a("b-td",{attrs:{colspan:"1"}},[e._v(e._s(e.ImageData.user))])],1),a("b-tr",[a("b-td",{attrs:{colspan:"2"}},[e._v("系统镜像ID号")]),a("b-td",{attrs:{colspan:"1"}},[e._v(e._s(e.ImageData.sn))])],1),a("b-tr",[a("b-td",{attrs:{colspan:"2"}},[e._v("镜像存储路径")]),a("b-td",{attrs:{colspan:"1"}},[e._v(e._s(e.ImageData.path))])],1),a("b-tr",[a("b-td",{attrs:{colspan:"2"}},[e._v("系统镜像权限")]),a("b-td",{attrs:{colspan:"1"}},["pv"==e.ImageData.perm?a("span",[e._v("私有")]):"pu"==e.ImageData.perm?a("span",[e._v("公开")]):a("span",[e._v("权限错误")])])],1),a("b-tr",[a("b-td",{attrs:{colspan:"2"}},[e._v("系统镜像大小")]),a("b-td",{attrs:{colspan:"1"}},[e._v(e._s(e.ImageData.size))])],1),a("b-tr",[a("b-td",{attrs:{colspan:"2"}},[e._v("系统镜像描述")]),a("b-td",{attrs:{colspan:"1"}},[e._v(e._s(e.ImageData.desc))])],1),a("b-tr",[a("b-td",{attrs:{colspan:"2"}},[e._v("镜像创建时间")]),a("b-td",{attrs:{colspan:"1"}},[e._v(e._s(e.ImageData.create_time))])],1)],1)],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.DetailImageForm=!1}}},[e._v("关 闭")])],1)])],1),a("el-table",{ref:"multipleTable",staticClass:"table",attrs:{data:e.ImagesData,"header-cell-class-name":"table-header"}},[e.show?a("el-table-column",{attrs:{prop:"id",label:"ID",align:"center",width:"80"}}):e._e(),a("el-table-column",{attrs:{prop:"image",label:"镜像名称",align:"center",width:"180px"}}),a("el-table-column",{attrs:{prop:"sn",label:"镜像ID号",align:"center",width:"250px"}}),a("el-table-column",{attrs:{prop:"desc",label:"镜像描述",align:"center",width:"200px"}}),a("el-table-column",{attrs:{prop:"perm",label:"镜像权限",align:"center",width:"100px"},scopedSlots:e._u([{key:"default",fn:function(t){return["pv"===t.row.perm?a("span",{staticStyle:{color:"#37B328"}},[e._v("私有")]):a("span",{staticStyle:{color:"red"}},[e._v("公开")])]}}])}),a("el-table-column",{attrs:{label:"操作",align:"center",width:"400px",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"设置镜像权限",placement:"top-start"}},[a("el-button",{attrs:{icon:"el-icon-key",circle:""},on:{click:function(a){return e.ChangePerm(t.row)}}})],1),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"设置镜像用户",placement:"top-start"}},[a("el-button",{attrs:{icon:"el-icon-user",circle:""},on:{click:function(a){return e.ImageEdit(t.row)}}})],1),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"系统镜像信息",placement:"top-start"}},[a("el-button",{attrs:{icon:"el-icon-s-grid",circle:""},on:{click:function(a){return e.ImageDetail(t.row)}}})],1),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"删除系统镜像",placement:"top-start"}},[a("el-button",{attrs:{type:"danger",icon:"el-icon-delete",circle:""},on:{click:function(a){return e.ImageDel(t.row.id,t.row.image)}}})],1)]}}])})],1),a("div",{staticClass:"block",staticStyle:{height:"70px"}},[a("el-pagination",{attrs:{"page-sizes":[10,20],"page-size":e.page.pageSize,layout:"total, sizes, prev, pager, next",total:e.page.totalRecords},on:{"size-change":e.sizeChange,"current-change":e.currentChange}})],1)],1)},s=[],r=(a("96cf"),a("1da1")),n=a("0c6d"),o=sessionStorage.getItem("user_info"),l=JSON.parse(o),c={data:function(){return{show:!1,fileList:[],ImageData:[],ImagesData:[],UserList:[],AddImageForm:!1,EditImageForm:!1,DetailImageForm:!1,add_image:{image:"",desc:"",size:"",file:""},EditImage:{id:"",user:""},EditImageRules:{user:[{required:!0,message:"请选择用户",trigger:"blur"}]},AddImageRules:{image:[{required:!0,message:"请输入系统镜像名称",trigger:"blur"}],desc:[{required:!0,message:"请选择镜像描述",trigger:"blur"}]},page:{pageSize:10,totalRecords:0,totalPages:0,pageNum:0,pagelimit:0}}},mounted:function(){this.getImages()},methods:{EditImageDialogClose:function(){void 0!==this.$refs.EditImageRef&&this.$refs.EditImageRef.resetFields()},AddImageDialogClose:function(){void 0!==this.$refs.AddImageRef&&this.$refs.AddImageRef.resetFields()},getImages:function(){var e=this;this.ImagesData=[];var t=this.page,a=t.pageNum,i=t.pageSize,s=t.pagelimit;s=a*i,Object(n["a"])({url:"/images?skip="+s+"&limit="+i,method:"get",headers:{authorization:l.token_type+" "+l.access_token}}).then((function(t){e.page.totalRecords=t.data.count,e.ImagesData=t.data.data}))},sizeChange:function(e){this.page.pageSize=e,this.getImages()},currentChange:function(e){this.page.pageNum=e-1,this.getImages()},CreateImage:function(){this.$refs.upload.submit()},UploadForm:function(e){var t=this,a=new FormData;a.append("name",this.add_image.image),a.append("desc",this.add_image.desc),a.append("size",e.size),a.append("files",e),this.$refs.AddImageRef.validate(function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(i){var s,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(i){e.next=3;break}return t.$message.error("请输入系统镜像信息"),e.abrupt("return",!1);case 3:s={headers:{authorization:l.token_type+" "+l.access_token,"Content-Type":"multipart/form-data"}},r="/image",t.$axios.post(r,a,s).then((function(e){200===e.data.code?(t.$message.success("创建系统镜像"+e.data.data[0].image+"成功"),t.AddImageForm=!1,t.$refs.AddImageRef.resetFields(),t.getImages()):t.$message.error("创建系统镜像失败,镜误原因 "+e.data.message)}));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},ImageEdit:function(e){this.FetchUserList(),this.EditImageForm=!0,this.EditImage.id=e.id},FetchUserList:function(){var e=this;this.UserList=[],Object(n["c"])({url:"/userlist",method:"get",headers:{authorization:l.token_type+" "+l.access_token}}).then((function(t){e.UserList=t.data}))},ImageEditForm:function(){var e=this;this.$refs.EditImageRef.validate(function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(a){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(a){t.next=3;break}return e.$message.error("请选择磁盘镜像的用户"),t.abrupt("return",!1);case 3:Object(n["a"])({url:"/setimageuser",method:"post",data:e.EditImage,headers:{authorization:l.token_type+" "+l.access_token}}).then((function(t){200===t.data.code?(e.$message.success("设置磁盘镜像"+t.data.data[0].image+"用户成功"),e.EditImageForm=!1,e.$refs.EditImageRef.resetFields(),e.getImages()):e.$message.error("修改磁盘镜像的用户失败,错误  "+red.data.message)}));case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())},ChangePerm:function(e){var t=this;if("pv"===e.perm){var a={id:e.id,perm:"pu"};this.$confirm("设置公开磁盘镜像"+e.image+", 是否继续?","提示",{type:"warning"}).then((function(){Object(n["a"])({url:"/setimageperm",method:"post",data:a,headers:{authorization:l.token_type+" "+l.access_token}}).then((function(a){200===a.status?(t.$message.success("磁盘镜像"+a.data.data[0].image+"权限已设置为公开"),t.getImages()):t.$message.error("磁盘镜像"+e.image+"权限已设置失败,原因  "+a.data.message)}))})).catch((function(){}))}else{var i={id:e.id,perm:"pv"};this.$confirm("设置磁盘镜像"+e.image+"为私有, 是否继续?","提示",{type:"warning"}).then((function(){Object(n["a"])({url:"/setimageperm",method:"post",data:i,headers:{authorization:l.token_type+" "+l.access_token}}).then((function(a){200===a.status?(t.$message.success("磁盘镜像"+a.data.data[0].image+"权限已设置为私有"),t.getImages()):t.$message.error("磁盘镜像"+e.image+"权限已设置失败,原因  "+a.data.message)}))})).catch((function(){}))}},ImageDetail:function(e){this.DetailImageForm=!0,this.getImageDetail(e.id)},getImageDetail:function(e){var t=this;this.ImageData=[];var a="/image/"+e;Object(n["a"])({url:a,method:"get",headers:{authorization:l.token_type+" "+l.access_token}}).then((function(e){t.ImageData=e.data}))},ImageDel:function(e,t){var a=this;this.$confirm("将永久删除磁盘镜像 "+t+", 是否继续?","提示",{type:"warning"}).then((function(){Object(n["a"])({url:"/deleteimage/"+e,method:"post",headers:{authorization:l.token_type+" "+l.access_token}}).then((function(e){200===e.data.code?(a.$message.success("删除磁盘镜像"+e.data.data[0].image+"成功"),a.getImages()):a.$message.error("删除磁盘镜像失败  "+e.data.message)}))})).catch((function(){}))}}},d=c,m=(a("2aab"),a("2877")),u=Object(m["a"])(d,i,s,!1,null,"0931b302",null);t["default"]=u.exports},"1da1":function(e,t,a){"use strict";function i(e,t,a,i,s,r,n){try{var o=e[r](n),l=o.value}catch(c){return void a(c)}o.done?t(l):Promise.resolve(l).then(i,s)}function s(e){return function(){var t=this,a=arguments;return new Promise((function(s,r){var n=e.apply(t,a);function o(e){i(n,s,r,o,l,"next",e)}function l(e){i(n,s,r,o,l,"throw",e)}o(void 0)}))}}a.d(t,"a",(function(){return s}))},"2aab":function(e,t,a){"use strict";a("3e63")},"3e63":function(e,t,a){}}]);